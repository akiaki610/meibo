<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>運転会出席名簿</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
  font-family: system-ui, sans-serif;
  margin: 0;
  background: #f2f2f2;
}
header {
  position: sticky;
  top: 0;
  background: #ffffff;
  padding: 14px;
  border-bottom: 1px solid #ccc;
  z-index: 10;
}
h1 {
  font-size: 18px;
  margin: 0 0 6px;
}
#count {
  font-weight: bold;
}
main {
  padding: 12px;
}
.add {
  display: flex;
  gap: 8px;
  margin-bottom: 12px;
}
.add input {
  flex: 1;
  padding: 12px;
  font-size: 16px;
  border-radius: 10px;
  border: 1px solid #ccc;
}
.add button {
  padding: 12px;
  font-size: 16px;
  border-radius: 10px;
  border: none;
  background: #1976d2;
  color: #fff;
}
.person {
  display: flex;
  align-items: center;
  background: #fff;
  margin-bottom: 8px;
  padding: 10px;
  border-radius: 12px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
}
.person input[type="checkbox"] {
  width: 26px;
  height: 26px;
}
.person input[type="text"] {
  flex: 1;
  margin: 0 8px;
  font-size: 16px;
  padding: 6px;
  border: none;
  border-bottom: 1px solid #ccc;
}
.person button {
  background: #c62828;
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 8px;
}
</style>
</head>

<body>

<header>
  <h1>521系運転会出席名簿</h1>
  <div id="stats">
    合計：<span id="total">0</span>人 /
    出席：<span id="present">0</span>人 /
    欠席：<span id="absent">0</span>人
  </div>
</header>


<main>
  <div class="add">
    <input id="nameInput" placeholder="参加者名を追加">
    <button onclick="addPerson()">追加</button>
  </div>

  <div id="list"></div>
</main>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCDAErGXOKmTsL2XIe3xLO_lH1GN-62FgQ",
  authDomain: "meibo-2d31f.firebaseapp.com",
  databaseURL: "https://meibo-2d31f-default-rtdb.firebaseio.com",
  projectId: "meibo-2d31f",
  storageBucket: "meibo-2d31f.firebasestorage.app",
  messagingSenderId: "513837039986",
  appId: "1:513837039986:web:60001fb633a00b368dddeb"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const ref = db.ref("attendance");

const list = document.getElementById("list");
const totalEl = document.getElementById("total");
const presentEl = document.getElementById("present");
const absentEl = document.getElementById("absent");


// リアルタイム表示
ref.on("value", snap => {
  const data = snap.val() || {};
  list.innerHTML = "";

  let total = 0;
  let present = 0;

  Object.entries(data).forEach(([id, p]) => {
    total++;

    const div = document.createElement("div");
    div.className = "person";

    const cb = document.createElement("input");
    cb.type = "checkbox";
    cb.checked = p.present || false;
    cb.onchange = () => {
      ref.child(id).update({ present: cb.checked });
    };

    const nameInput = document.createElement("input");
    nameInput.type = "text";
    nameInput.value = p.name;
    nameInput.onchange = () => {
      ref.child(id).update({ name: nameInput.value });
    };

    const del = document.createElement("button");
    del.textContent = "削除";
    del.onclick = () => {
      if (confirm("この参加者を削除しますか？")) {
        ref.child(id).remove();
      }
    };

    if (cb.checked) present++;

    div.append(cb, nameInput, del);
    list.appendChild(div);
  });

  const absent = total - present;

  totalEl.textContent = total;
  presentEl.textContent = present;
  absentEl.textContent = absent;
});


// 参加者追加
function addPerson() {
  const input = document.getElementById("nameInput");
  if (!input.value) return;
  ref.push({
    name: input.value,
    present: false
  });
  input.value = "";
}
</script>

</body>
</html>
